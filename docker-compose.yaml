version: "3.7"
services:
  backend:
    build:
      context: backend
      target: development
      args:
        - GOPROXY=https://goproxy.cn
    secrets:
      - app_crt
      - app_key
    env_file:
      - .env
    networks: 
      - app_net

  client:
    build:
      context: client
      target: development
      args:
        - GOPROXY=https://goproxy.cn
    secrets:
      - credential
    command: sleep infinity
    # depends_on:
      # - backend
    env_file:
      - .env
    networks: 
      - app_net

  proxy:
    build:
      context: proxy
      target: development
      args:
        - GOPROXY=https://goproxy.cn
    command: sleep infinity
    networks: 
      - app_net


secrets:
  app_crt:
    file: secrets/certs/web/app.crt
  app_key:
    file: secrets/certs/web/app.key
  boot.key:
    file: secrets/certs/local/boot.key
  boot.pem:
    file: secrets/certs/local/boot.pem

networks:
    app_net:
        external: true